# χ²-DFD 深度伪造检测系统 · 阶段性总结（2025-09）

## 1. 项目目标
- 复现论文《χ²-DFD》中 **Model Feature Assessment (MFA)** 模块。
- 在本地离线环境中完成 FaceForensics++ (c23) 的大规模实验，输出可解释的特征排序结果。
- 为后续的 MFC / MHR 模块研究与跨库实验奠定数据与工具基础。

## 2. 已完成工作
1. **环境与工具链**
   - 配置 Python 3.10 + CUDA + bitsandbytes 量化环境。
   - 本地下载 LLaVA-1.5-7B 权重，采用 4bit (nf4) 量化加载。
   - 建立 InsightFace（RetinaFace + SCRFD）抽帧裁脸流水线。

2. **数据准备**
   - 下载并清洗 FF++ c23，按方法分层生成 train(4000)/val(500)/test(500)。
   - 抽取 2 FPS、每段 ≤16 帧，并裁剪 224×224 人脸。
   - 生成 `metadata/ffpp_c23_split.json` 与 `data/processed/ffpp_c23/` 缓存。

3. **MFA 批量推理**
   - 依据 `config/mfa_questions.json` 的 20 个候选问题，对 val/test 集逐帧推理。
   - 脚本新增断点恢复与进度日志：`metadata/mfa_ffpp_<split>_progress.jsonl`。
   - 生成 `metadata/mfa_ffpp_val.json`、`metadata/mfa_ffpp_test.json` 及综合排名 `metadata/mfa_feature_rankings.json`。

## 3. 关键指标
| Question ID | Category | Val BA | Test BA | Avg BA |
|-------------|----------|--------|---------|--------|
| facial_symmetry | Symmetry | 0.616 | 0.630 | **0.623** |
| shadow_anomaly | Lighting | 0.620 | 0.609 | **0.614** |
| hairline_artifact | Hair | 0.571 | 0.578 | **0.574** |
| edge_color_bleeding | Color | 0.556 | 0.546 | **0.551** |
| feature_perspective | Geometry | 0.531 | 0.539 | **0.535** |
| compression_inconsistency | Signal | 0.529 | 0.529 | 0.529 |
| teeth_boundary_drift | Mouth | 0.523 | 0.510 | 0.516 |
| skin_texture_repeat | Texture | 0.513 | 0.513 | 0.513 |
| feature_proportions | Symmetry | 0.510 | 0.515 | 0.512 |
| jawline_seams | Blending | 0.509 | 0.513 | 0.511 |

- 平均 BA > 0.55 的问题覆盖 Lighting、Symmetry、Hair、Color 等多种伪造线索。
- 低于 0.5 的问题（如 `teeth_texture`、`blending_feather`）将作为候选剔除项。

## 4. 经验与注意事项
- **运行时间**：500 段视频的 MFA 在 4bit 模式下约需 60+ 小时；可通过 `--frames-per-video` 控制计算量。
- **断点续跑**：
  - 抽帧脚本支持重复执行覆盖缓存。
  - MFA 脚本会跳过 `progress.jsonl` 中已有的视频，适合长时间任务。
- **磁盘占用**：裁脸缓存约 2 GB，原始帧约 12 GB；可按需求清理 `raw_frames`。
- **Git 管理**：数据目录已加入 `.gitignore`，远程仓库仅保留脚本、元数据与结果。

## 5. 下一阶段计划
1. **特征精简**：基于当前 Top-K 问题尝试训练轻量级分类器或评分模型。
2. **跨库评估**：在 Celeb-DF v2 上重复抽帧 + MFA，验证泛化能力。
3. **可解释性可视化**：将问题与可视化输出结合，形成最终报告。
4. **自动化流水线**：封装完整步骤为脚本或 Snakemake 流程，缩短复现成本。

如需查看完整日志与结果，请参考 `metadata/` 目录下的 JSON/JSONL 文件。
